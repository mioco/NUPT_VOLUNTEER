<!DOCTYPE html>
<html>
<head>
	<title>{$name} {$seo_title} {$site_name}</title>
	<meta name="keywords" content="{$seo_keywords}" />
	<meta name="description" content="{$seo_description}">
    <tc_include file="Public:head" />
</head>
<body>
<tc_include file="Public:nav" />
    <div class="container"> 
    <php>       
        $terms = sp_get_child_terms(3);
    </php>
    <div class="term-bar">
        <div class="term-status status-bar">
            <span>状态</span>
            <a href="">全部</a>
            <a class="recruiting">招募中</a>
            <a class="underway">进行中</a>
            <a class="over">已结束</a>
        </div>
        <div class="term-status">
            <span>分类</span>
            <a id="term-item-3" href="{:u('list/index?id=3')}"><span>最新</span></a>
            <foreach name="terms" item="te">
                <a id="term-item-{$te.term_id}" href="{:u('list/index?id='.$te['term_id'])}"><span>{$te.name}</span></a>
            </foreach>
        </div>
    </div>
    <php>
        $tag = "field:active_status,object_id,tid,object_id,post_title,post_address,post_date,recruit_end_time,active_end_time,smeta,post_hits,post_like;order:post_date desc;";
        $posts = sp_sql_posts_paged_bycatid(1,$tag,16,$pagesetting);
        foreach($posts['posts'] as &$po){
            $date_calculate = date_calculate($po['post_date'],$po['recruit_end_time'],$po['active_end_time']);
            $po['time_width'] = $date_calculate[0];
            $po['residue'] = $date_calculate[1];
            $po['join_count'] = join_count_where($po['object_id']);
        }
        $status = array("0" => $[, "1" => "进行中", "2" => "已结束");
    </php>
    <div class="list-container row">
        <volist name="posts['posts']" id="vo">
        <php>$smeta=json_decode($vo['smeta'],true);</php>
        <div class="post-box">
            <div class="tc-gridbox">
                <div class="header">
                    <div class="item-image">
                        <a href="{:leuu('article/index',array('id'=>$vo['tid']))}">
                            <if condition="empty($smeta['thumb'])"> 
                                <img src="__TMPL__Public/images/default_tupian1.png" class="img-responsive" alt="{$vo.post_title}"/>
                            <else /> 
                                <img src="{:sp_get_asset_upload_path($smeta['thumb'])}" class="img-responsive img-thumbnail" alt="{$vo.post_title}" />
                            </if>
                        </a>
                    </div>
                    <h3><a href="{:leuu('article/index',array('id'=>$vo['tid']))}">{$vo.post_title}</a></h3>
                </div>
                <div class="body">
                    <p>活动地点：{$vo.post_address}</p>
                    <p>活动发起：{$vo.user_login}</p>
                    <div class="timebox">
                        <p>报名截止：</p>
                        <p><div class="time"><div class="pass_time" id="{$vo.tid}" style="width:{$vo.time_width}%"></div></div></p>
                        <p class="residue">{$status[$vo['active_status']]}</p>
                    </div>
                </div>
                <div class="footer">
                    <i class="fa fa-user"></i>{$vo.join_count}&nbsp;
                    <i class="fa fa-eye"></i>{$vo.post_hits}
                </div>
            </div>
        </div>
        </volist>
    </div>
    <div class="pagination"><ul>{$posts['page']}</ul></div>
    <hr>
<tc_include file="Public:footer"/>
</div>
    
<!-- JavaScript -->
<tc_include file="Public:scripts" />
 <script src="__TMPL__Public/js/imagesloaded.pkgd.min.js"></script>
    <script src="__TMPL__Public/js/masonry.pkgd.min.js"></script>
	<script>
	var $container=$('#container').masonry({
		  columnWidth: '.grid-sizer',
		  itemSelector: '.item'
		});
	// layout Masonry again after all images have loaded
	$container.imagesLoaded( function() {
	  $container.masonry();
	});
	
	</script>
</body>
</html>